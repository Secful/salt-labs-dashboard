<div class="dashboard-page">
    <button (click)="openNewInstanceDialog()" class="button primary"><span class="plus-icon"
            [innerHTML]="plusIcon"></span>New Lab Domain</button>
    <div class="dashboard-wrapper">
        <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start">
            <mat-tab label="Instances">
                <table mat-table [dataSource]="dataSource" multiTemplateDataRows
                    class="dashboard-table mat-elevation-z8">
                    <ng-container matColumnDef="{{column.field}}" *ngFor="let column of defaultColumnsToDisplay">
                        <th mat-header-cell *matHeaderCellDef> {{column.header}} </th>
                        <td mat-cell *matCellDef="let element">{{element[column.field]}}</td>
                    </ng-container>
                    <ng-container matColumnDef={{column.field}} *ngFor="let column of dateColumnsToDisplay">
                        <th mat-header-cell *matHeaderCellDef>{{column.header}}</th>
                        <td mat-cell *matCellDef="let element">
                            {{element[column.field] | date:"MMM dd yyyy, HH:mm"}}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="vulnerable_applications">
                        <th mat-header-cell *matHeaderCellDef>Learned API</th>
                        <td mat-cell *matCellDef="let element">
                            <div class="learned-apis-chips">
                                <span class="api-chip"
                                    *ngFor="let chip of element.vulnerable_applications">{{chip}}</span>
                            </div>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="ttl_expiration_date">
                        <th mat-header-cell *matHeaderCellDef>TTL - expiration date</th>
                        <td mat-cell *matCellDef="let element">{{element.ttl_expiration_date < 0 ? 'Expired' :
                                element.ttl_expiration_date}}</td>
                    </ng-container>
                    <ng-container matColumnDef="expand">
                        <th mat-header-cell *matHeaderCellDef aria-label="row actions">&nbsp;</th>
                        <td mat-cell *matCellDef="let element">
                            <button mat-icon-button class="expand-button" aria-label="expand row"
                                (click)="(expandedElement = expandedElement === element ? null : element); $event.stopPropagation(); onDomainClick(expandedElement)">
                                <div [innerHTML]="expandedElement === element ? chevronDownIcon : chevronRightIcon">
                                </div>
                            </button>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="extra_buttons">
                        <th mat-header-cell *matHeaderCellDef aria-label="row actions">&nbsp;</th>
                        <td mat-cell *matCellDef="let element">
                            <button class="action-button" (click)="cloneDomain(element)">
                                <div aria-label="Clone" [innerHTML]="cloneIcon"></div>
                            </button>
                            <button class="action-button" (click)="deleteDomain(element)">
                                <div aria-label="Delete" [innerHTML]="trashIcon"></div>
                            </button>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="expandedDetail">
                        <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplayWithExpand.length">
                            <div class="element-detail"
                                [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                                <div class="element-description">
                                    <mat-accordion>
                                        <ng-container *ngIf="element.labs.length > 1; else singleInstance">
                                            <app-lab-accordion *ngFor="let labInstance of element.labs"
                                                [labInfo]="labInstance" class="lab-instance"></app-lab-accordion>
                                        </ng-container>
                                        <ng-template #singleInstance><app-lab-instance [labInfo]="element.labs[0]"
                                                [lab]="lab"></app-lab-instance></ng-template>
                                    </mat-accordion>
                                </div>
                            </div>
                        </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="columnsToDisplayWithExpand" class="element-header-row"></tr>
                    <tr mat-row *matRowDef="let element; columns: columnsToDisplayWithExpand;" class="element-row"
                        [class.expanded-row]="expandedElement === element">
                    </tr>
                    <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr>
                </table>
            </mat-tab>
        </mat-tab-group>
    </div>
</div>